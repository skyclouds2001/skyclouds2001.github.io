---
title: 性能优化
date: 2023-09-18 12:36:26
tags:
- Frontend
- Other
categories:
- [Frontend, Other]
thumbnail: 
---

## 打包相关

### 路由懒加载

最主要在于降低首屏加载资源大小，仅加载所需的页面资源文件，加快页面的显示

```js
import C from 'c'

{
  component: C,
}
```

```js
{
  component: () => import('c'),
}
```

原理即将导航中的路由组件从静态 ESM 导入改为动态 import() 导入

### 组件懒加载

原理同路由懒加载

```js
import C from 'c'

export default {
  components: {
    C,
  },
}
```

```js
const C = () => import('c')

export default {
  components: {
    C,
  },
}
```

做组件懒加载的场景：组件仅在特定条件下才展示、当前页面文件过大、组件复用性较强

### Tree Shaking

依赖 ESM 特性，进行静态依赖分析，在产物代码文件中去除未使用的部分

因此建议使用函数式编程，以便利 Tree Shaking

## 渲染相关

### 骨架屏

主要应用于缩短白屏时长，特别是 SPA 单页应用

原理是直接把展示骨架屏的内容放在 html 文件内，在真正内容加载完后再隐藏骨架屏的内容

### 虚拟滚动

只渲染可视区域的列表项，非可见区域的不渲染

原理为计算列表的总高度，并在触发滚动事件时根据滚动高度更新起始下标和结束下标，从而取出相应的数据渲染元素

### Worker 长任务优化

将一些长任务逻辑移入到 Worker 中

无论是 Web Worker、Shared Worker 或 Service Worker 均可

是否使用 Worker，需要比较 Worker 通信时长与运算时长相比是否具有足够的优势

### requestAnimationFrame 周期任务

可以利用 requestAnimationFrame 处理周期任务

特别是需要较严格固定周期频率执行的情况

同时可以在页面隐藏或最小化时暂停执行周期任务，以节省性能

## 资源相关

### script 加载方式

* 正常模式

JS 会阻碍 DOM 渲染

`<script src="main.js"></script>`

* async 模式

异步加载 JS，执行无顺序，加载完成后立即执行

可以用于加载与 DOM 无关的 JS 资源，如埋点统计等

`<script async src="main.js"></script>`

* defer 模式

异步加载 JS，执行有顺序，加载完成后统一在 DOMContentLoaded 事件触发前执行

一般情况均可使用 defer 优化 JS 资源的加载

`<script defer src="main.js"></script>`

* module 模式

行为上会类似于 defer 模式

`<script type="module" src="main.js"></script>`

### 资源预加载

* preload

预先下载当前页面将使用的资源并缓存（不会执行），会提升资源的优先级

需同时指定 as 属性与 href 属性

`<link rel="preload" href="style.css" as="style" />`

`<link rel="preload" href="main.js" as="script" />`

建议指定 type 属性，以避免浏览器下载格式不支持的资源

建议同时指定 crossorigin 属性

* prefetch

预加载未来页面将使用的资源，并保存在缓存内一段时间，会降低资源的优先级

要求当前页面需为安全上下文

`<link rel="prefetch" href="main.js" />`

* modulepreload

类似于 preload

预加载当前页面将使用的模块脚本资源，并进行解析与执行

`<link rel="modulepreload" href="main.js" />`

* prerender

预加载目标资源并提前在后台处理执行

### 预连接

一般情况下，dns-prefetch 与 preconnect 都是配对使用

但不建议过度使用 preconnect，仅用于未来一段时间极可能访问或请求的 origin；否则仅应用 dns-prefetch

同时 dns-prefetch 的浏览器兼容性优于 preconnect

建议同时指定 crossorigin 属性

* dns-prefetch

提前执行目标 origin 的 DNS 解析，可以加快未来将访问或请求的 origin 的处理速度（直接使用已预先解析的 DNS 缓存）

`<link rel="dns-prefetch" href="https://fonts.googleapis.com/" />`

* preconnect

提前执行目标 origin 的连接 —— DNS 解析、TCP 连接（及 TLS 握手），可以加快未来将访问或请求的 origin 的处理速度

`<link rel="preconnect" href="https://fonts.googleapis.com/" />`

## 图片相关

### 图片懒加载

* JS 方式

动态在图片需要展示时再指定其 src 属性，避免图片的自动预加载

### 字体图标

将小图标利用字体形式加载

通常加载资源大小会更小，并且能够避免重复加载图片并降低请求数量，且能够自由地修改各类样式

### 内联图片

将小图片转换为 base64 编码内联入 html 文档，适当情况可以减少请求数量

webpack 中可以使用 `url-loader` 插件处理
